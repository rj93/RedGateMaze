<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="noindex, nofollow">
	<meta name="revisit-after" content="7 days">

	<link rel="stylesheet" href="./css/bootstrap.min.css">
	<link rel="stylesheet" href="./css/website.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet"> 

	<link rel="stylesheet" href="./fonts/font-awesome/css/font-awesome.min.css">

	<script type="text/javascript" src="./js/jquery.min.js"></script>
	<script type="text/javascript" src="./js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/website.js"></script>

	<title>Red Gate Maze Challenge</title>

	
</head>

	<body>
		<div class="container">
			
			<div id="controls">

				<div class="input-group col-md-2">
					<span class="input-group-addon" id="width-addon">Width</span>
					<input type="number" class="form-control" id="width" min="5" max="50" value="20" aria-describedby="width-addon">
				</div>

				<div class="input-group col-md-2">
					<span class="input-group-addon" id="height-addon">Height</span>
					<input type="number" class="form-control" id="height" min="5" max="50" value="20" aria-describedby="height-addon">
				</div>

				<button type="button" class="btn btn-primary" onclick="maze.generate()">Generate</button>

			</div>
			<div id="maze"></div>
		</div>
	</body>

	<script type="text/javascript">

		class Maze {
			constructor (width, height) {
				this.width = width;
				this.height = height;
				this.grid = [];
				for(var i=0; i<width; i++) {
					this.grid[i] = [];
					for(var j=0; j<height; j++) {
						this.grid[i][j] = new Cell(i, j);
					}
				}
				this.start = this.grid[0][0];
				this.end = this.grid[width-1][height-1];

				this.start.removeWallTop();
				this.start.addClass("start");
				this.end.removeWallBottom();
				this.end.addClass("end");
			}

			generate() {
				var stack = [];
				var cell, neighbours;

				stack.push(this.grid[0][0]);

				while(stack.length > 0){
					cell = stack.pop();
					cell.visit();

					if (!(cell.x == this.end.x && cell.y == this.end.y)){ // without this check there is the possibility for the end cell to be missing three walls

						var neighbours = this.getNeighbours(cell);
						if (neighbours.length > 1){ // JS array doesn't have a peek, so need to re-add the cell if it still has unexplored neighbours
							stack.push(cell);
						}

						var next = neighbours[Math.floor(Math.random() * neighbours.length)];
						if (next){
							stack.push(next);
							if (cell.getX() < next.getX()){ // next is below
								cell.removeWallBottom();
								next.removeWallTop();
							} else if (cell.getX() > next.getX()){ // next is above
								cell.removeWallTop();
								next.removeWallBottom();
							} else if (cell.getY() < next.getY()){ // next is to the right
								cell.removeWallRight();
								next.removeWallLeft();
							} else { // next is to the left
								cell.removeWallLeft();
								next.removeWallRight();
							}
						}
					}
				}

			}

			getNeighbours(cell) {
				var x = cell.getX();
				var y = cell.getY();

				var neighbours = []
				if (x != 0) {
					// add top
					if (!this.grid[x-1][y].getVisited()){
						neighbours.push(this.grid[x-1][y]);
					}
				} 
				if (x != this.width - 1) {
					// add bottom
					if (!this.grid[x+1][y].getVisited()){
						neighbours.push(this.grid[x+1][y]);
					}
				}
				
				if (y != 0) {
					// add left
					if (!this.grid[x][y-1].getVisited()){
						neighbours.push(this.grid[x][y-1]);
					}
				} 
				if (y != this.height - 1){
					// add right
					if (!this.grid[x][y+1].getVisited()){
						neighbours.push(this.grid[x][y+1]);
					}
				}

				return neighbours;
			}
		}

		class Cell {
			constructor(x, y) {
				this.x = x;
				this.y = y;
				this.visited = false;
				this.wallTop = true;
				this.wallBottom = true;
				this.wallLeft = true;
				this.wallRight = true;
			}

			getX() {
				return this.x;
			}

			getY() {
				return this.y;
			}

			getCoordinates() {
				return {'x': this.x, 'y': this.y};
			}

			visit() {
				this.visited = true;
			}

			getVisited() {
				return this.visited;
			}

			removeWallTop() {
				this.wallTop = false;
				this.addClass("no-wall-top");
			}

			removeWallBottom() {
				this.wallBottom = false;
				this.addClass("no-wall-bottom");
			}

			removeWallLeft() {
				this.wallLeft = false;
				this.addClass("no-wall-left");
			}

			removeWallRight() {
				this.wallRight = false;
				this.addClass("no-wall-right");
			}

			addClass(classToAdd) {
				$("#cell-" + this.x + "-" + this.y + ".cell").addClass(classToAdd);
			}

		}

			
		var width, height;
		var maze;


		$(document).ready(function() {
			initMaze();
		});

		$("#width").on('input', function() {
			$("#maze").empty();
			initMaze();
		});

		$("#height").on('input', function() {
			$("#maze").empty();
			initMaze();
		})

		function initMaze(){
			width = $("#width").val();
			height = $("#height").val();
			$("#maze").css("min-width", width*10+"px"); // stop maze losing its structure on resize
			for(var x = 0; x < width; x++) {
				var row = $("<div class='row' id='row-"+x+"'></div>");
				row.appendTo("#maze")
				for(var y = 0; y < height; y++) {
					var unit = $("<div class='cell' id='cell-"+x+"-"+y+"'></div>");
					unit.appendTo("#row-"+x);
				}
			}
			maze = new Maze(width, height);
		}

	</script>

</html>